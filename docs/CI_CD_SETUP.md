# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è (CI/CD)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ VPS —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ –≤ –≤–µ—Ç–∫—É `main`.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ –≤–µ—Ç–∫—É `main` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è GitHub Actions
2. –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (CI) - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –≤—Å–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è
3. –ï—Å–ª–∏ —Å–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–µ–ø–ª–æ–π –Ω–∞ VPS (CD)
4. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `git pull`, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
5. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ GitHub

–î–ª—è —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –û—Ç–∫—Ä–æ–π—Ç–µ **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
3. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã:

- **`VPS_HOST`** - IP –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –≤–∞—à–µ–≥–æ VPS —Å–µ—Ä–≤–µ—Ä–∞
  - –ü—Ä–∏–º–µ—Ä: `123.45.67.89` –∏–ª–∏ `server.example.com`

- **`VPS_USER`** - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - –ü—Ä–∏–º–µ—Ä: `root` –∏–ª–∏ `deploy`

- **`VPS_SSH_KEY`** - –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
  - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `~/.ssh/id_rsa` (–∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞)
  - –í–∞–∂–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á –±–µ–∑ –ø–∞—Ä–æ–ª—è –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSH agent

- **`VPS_SSH_PORT`** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ü–æ—Ä—Ç SSH, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 22
  - –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç 22, –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å

- **`FRONTEND_URL`** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - URL –≤–∞—à–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ GitHub
  - –ü—Ä–∏–º–µ—Ä: `https://xn----8sbgxcrot9b.xn--p1ai`

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—â–µ –Ω–µ—Ç SSH –∫–ª—é—á–∞:

```bash
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –∫–ª—é—á (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/github_deploy

# –ö–æ–ø–∏—Ä—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i ~/.ssh/github_deploy.pub user@your-server-ip

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ GitHub Secrets
cat ~/.ssh/github_deploy
```

**–í–∞–∂–Ω–æ:** –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã `cat`, –≤–∫–ª—é—á–∞—è —Å—Ç—Ä–æ–∫–∏ `-----BEGIN OPENSSH PRIVATE KEY-----` –∏ `-----END OPENSSH PRIVATE KEY-----`

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Git –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é:
```bash
cd /opt/media-archive/archive
git remote -v  # –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```

2. –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –∫–ª—é—á –¥–ª—è Git:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh-keygen -t ed25519 -C "server-deploy"
cat ~/.ssh/id_ed25519.pub
# –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–ª—é—á –≤ GitHub: Settings ‚Üí SSH and GPG keys ‚Üí New SSH key
```

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ Docker:
```bash
# –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER
# –ü–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
newgrp docker
```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω–∞:
```bash
ls -la /opt/media-archive/archive
# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∏–¥–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –ø—Ä–æ–µ–∫—Ç–æ–º
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤:

1. –°–¥–µ–ª–∞–π—Ç–µ –∫–æ–º–º–∏—Ç –∏ push –≤ –≤–µ—Ç–∫—É `main`:
```bash
git add .
git commit -m "Test CI/CD"
git push origin main
```

2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitHub ‚Üí **Actions** –≤ –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
3. –í—ã —É–≤–∏–¥–∏—Ç–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π workflow
4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–µ–ª–µ–Ω—ã–π —Å—Ç–∞—Ç—É—Å ‚úÖ

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π –≤—Ä—É—á–Ω—É—é:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitHub ‚Üí **Actions**
2. –í—ã–±–µ—Ä–∏—Ç–µ workflow "CI/CD Pipeline"
3. –ù–∞–∂–º–∏—Ç–µ **Run workflow**
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É `main` –∏ –Ω–∞–∂–º–∏—Ç–µ **Run workflow**

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ—è

–í –ª–æ–≥–∞—Ö GitHub Actions –≤—ã —É–≤–∏–¥–∏—Ç–µ:

- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —à–∞–≥–∏
- ‚ùå –û—à–∏–±–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- üìä –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- üè• –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ SSH

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `VPS_HOST` –∏ `VPS_USER`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSH –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç SSH –æ—Ç–∫—Ä—ã—Ç –≤ firewall

### –û—à–∏–±–∫–∞ "git pull failed"

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/opt/media-archive/archive`
- –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π, –¥–æ–±–∞–≤—å—Ç–µ SSH –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞ –≤ GitHub

### –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞: `df -h`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Docker —Ä–∞–±–æ—Ç–∞–µ—Ç: `docker ps`

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `docker compose -f docker-compose.prod.yml logs`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã –Ω–µ –∑–∞–Ω—è—Ç—ã: `netstat -tulpn | grep -E '80|443|4000'`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GitHub Secrets –¥–ª—è –≤—Å–µ—Ö —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ SSH –∫–ª—é—á–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–µ–ø–ª–æ—è (–Ω–µ root)
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–ø–ª–æ–µ

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram/Slack –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º/–Ω–µ—É—Å–ø–µ—à–Ω–æ–º –¥–µ–ø–ª–æ–µ. –î–ª—è —ç—Ç–æ–≥–æ –¥–æ–±–∞–≤—å—Ç–µ —à–∞–≥ –≤ workflow –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è.

### –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –ø—Ä–æ—à–µ–ª –Ω–µ—É–¥–∞—á–Ω–æ, –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/media-archive/archive
git checkout <–ø—Ä–µ–¥—ã–¥—É—â–∏–π-–∫–æ–º–º–∏—Ç>
docker compose -f docker-compose.prod.yml up -d --build
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–∞—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

